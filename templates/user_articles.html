{% extends 'base.html' %}

  {% block title %} 
    User Articles 
  {% endblock %}

{% block content %}
  
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class=flashes>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
    {% endif %}
  {% endwith %}

    <br><br>
      <h1>Welcome, {{ user_object.f_name }}!</h1>
    <br>
    {% if session.get("user_id")|string() == user_object.user_id|string() %}
      <form action="/create-article">
        <input type="hidden" name="user_id_from_form" value="{{ user_object.user_id }}">
        <input type="submit" name="submit" value="Add Article">
      </form>
    {% endif %}

    <h5>Tags</h5>
      <button type="button" class="filter" data-tagname="All Articles">All Articles</button></a>
    {% for tags in user_object.tags %}
      <button type="button" class="filter" data-tagname="{{ tags.tag_value }}">{{ tags.tag_value }}</button></a>
    {% endfor %}

    <span id="display-articles">
    <br>
    {% for article in user_object.articles %}
      <ul>
        <li>
          <a href="/article-closeup/{{ article.article_id }}">
          {{ article.article_title }}</a>
        </li>
      </ul>
    {% endfor %}
    </span>


<script type="text/javascript">

filters = $(".filter");

function getFilteredArticles(tagvalue) {
    $.get('/filter-articles/' + tagvalue, displayArticles);}

filters.on('click', function(evt) {
var tagvalue = $(this).data("tagname");
getFilteredArticles(tagvalue);
});

function displayArticles(articles_object) {
  $("#display-articles").empty();
  $("#display-articles").append("<br>");
  console.log("emptied")
  for (var key in articles_object) {
    let value = articles_object[key];
    $("#display-articles").append("<ul><li><a href=/article-closeup/"+key+">"+value+"</a></li></ul>");
  }
}
  </script>

  {% endblock %}

